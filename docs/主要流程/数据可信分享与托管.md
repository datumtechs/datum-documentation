
# 数据可信分享与托管
数据可信分享与托管，提供围绕数据分享与数据资产交易，提供相关的权限访问控制、资产所有权转让及确认、数据加密托管与安全使用等服务。

- 可以方便用户管理数据资产的鉴权访问；
- 可以方便用户实现数据资产的完整性验证；
- 可以方便用户设置数据资产的加密防护与可信安全分享。



## 数据可信分享
数据可信分享可按照数据资产不同的使用和交易方式，设置查看、转移、下载模式。具体包括：

- 元数据查看：查看Data NFT对应的元数据；
- 所有权转移：完成Data NFT购买后，售出所有权，将所有权转移给指定用户；
- 使用权获得：完成Data NFT购买后，售出数据资产的使用权（次数或者期限使用权），将特定类型的使用权赋予指定用户；



### 元数据查看

用户可以先通过查看已发布的元数据确定原始数据情况，判断是否需要购买对应的Data NFT. 用户可调用元数据查看API接口，在链上或数据服务平台上发起查询，此调用过程不需要鉴权。

#### 如何使用
- 接口名称：getMetaData
- 参数说明

  | 名称             | 类型    | 说明                            | 是否必填 |
  | ---------------- | ------- | ------------------------------- | -------- |
  | contract_address | address | NFT合约地址                     | Y        |
  | chainId          | uint32  | 链id，默认为1，表示ethereum主网 | N        |
  | tokenid          | string  | NFT的id                         | Y        |

- 响应

  ```json
  {
  	"status": 200,
  	"result": {
  		"token_address": "0x8df91a59b8610990004987ac6ad8b6e70779ee97",
  		"token_id": "1",
  		"owner_of": "0x806164c929ad3a6f4bd70c2370b3ef36c64deaa8",
  		"contract_type": "ERC721",
  		"name": "datum",
  		"symbol": "FZAI1",
          "file_hash": "0x.....................",
          "storage_method": "hosting/Unmanaged",
          "permission_type": "ownership/use", 
  		"metadata": "{
          	"name": "datum", 
          	"description": "this is datum metadata", 
          	"data_size": 100, 
              "columns": 2, 
              "rows": 10, 
              "cols_desc": [
                  {"col_name": "col1", "col_desc": "this is col1 desc"},
                  {"col_name": "col2", "col_desc": "this is col2 desc"}
  			]
  		}"
  	},
  	"msg": "get MetaData success."
  }
  ```

- 示例

  ```shell
  curl --request POST \
       --url 'https://datum.io/api/v2/$contract_address/getMetaData?	     	chainId=$chainId&tokenid=$tokenid' \
       --header 'Accept: application/json' \
       --header 'Content-Type: application/json' \
       --header 'X-API-Key: test'
  ```


### 所有权转移

用户在确定需要某个数据资产后，与提供方达成数据资产交易买卖后，数据提供方可通过调用此API改变Data NFT的所有权属性，将该Data NFT转移给购买用户。获得所有权的用户可以访问、查看、下载该Data NFT对应的原始数据。


#### 如何使用
- 接口名称：passOwnership

- 参数说明

  | 名称             | 类型    | 说明                            | 是否必填 |
  | ---------------- | ------- | ------------------------------- | -------- |
  | contract_address | address | NFT合约地址                     | Y        |
  | chainId          | uint32  | 链id，默认为1，表示ethereum主网 | N        |
  | tokenid          | string  | NFT的id                         | Y        |
  | to_address       | address | 数据使用方地址                  | Y        |

- 响应

  ```json
  {
      "status": 200,
      "result": {
          transaction_hash: "0xxxxxxxxxxxxxxxxxxxx"
      },
      "msg": "pass NFT Ownership success."
  }
  ```

- 示例

  ```shell
  curl --request POST \
       --url 'https://datum.io/api/v2/$contract_address/passOwnership?	    chainId=$chainId&tokenid=$tokenid&to_address=$to_address' \
       --header 'Accept: application/json' \
       --header 'Content-Type: application/json' \
       --header 'X-API-Key: test'
  ```


### 使用权转移

用户在确定需要某个数据资产后，出于业务需求和资金考虑，只需要进行单次或一定期限内的查询或计算使用，在与提供方达成数据资产交易后，数据提供方可通过调用此API改变Data NFT的使用方式属性，将该Data NFT提供给购买用户。获得使用权的用户可以访问、查看、在限定范围内计算或使用该Data NFT对应的原始数据，该原始数据可能是明文或者以隐私计算的方式提供使用。

待补充...




## 数据可信托管

Datum提供原始数据的可信托管服务，包括（a）在提供的云服务、IPFS传输渠道上增加对数据资产使用权限的验证与管理；（b）基于代理重加密算法，为用户提供密文数据的传输存储，并提供加密公钥转换api，方便用户将密文数据分享给任意第三方，无需多次加解密，无需担心传输存储渠道的数据隐私安全问题。

具体服务内容包括：
- 数据资产使用权限验证：验证访问者持有的Data NFT权限，并做出相应反馈，包括能否访问明文数据、能否下载数据、是否只能查看计算等；
- 查看原始数据：可以访问、查看Data NFT对应的原数据存储位置；
- 下载原始数据：可以访问、下载Data NFT对应的原数据存储位置；
- 数据完整性验证：用户在获得、下载原始数据后，能够执行完整性/一致性验证。
- 代理重加密服务：包括重加密密钥生成、加密密钥转换服务。


### 数据资产使用权限

数据使用方持有Data NFT发起数据之前，可调用此API验证该NFT对应的数据资产使用权限。


#### 如何使用
- 接口名称：verifyAccess

- 参数说明

  | 名称             | 类型    | 说明                            | 是否必填 |
  | ---------------- | ------- | ------------------------------- | -------- |
  | contract_address | address | NFT合约地址                     | Y        |
  | chainId          | uint32  | 链id，默认为1，表示ethereum主网 | N        |
  | tokenid          | string  | NFT的id                         | Y        |
  | operate          | elem    | 1: 查看，2:下载                 | Y        |

- 响应

  ```json
  {
  	"status": 200,
  	"result": {
  		"token_address": "0x8df91a59b8610990004987ac6ad8b6e70779ee97",
  		"token_id": "1",
  		"owner_of": "0x806164c929ad3a6f4bd70c2370b3ef36c64deaa8",
  		"contract_type": "ERC721",
  		"name": "datum",
  		"symbol": "FZAI1",
          "operate": "view/download"
  	},
  	"msg": "Validation of access rights succeeded."
  }
  ```

- 示例

  ```shell
  curl --request POST \
       --url 'https://datum.io/api/v2/$contract_address/verifyAccess?	    chainId=$chainId&tokenid=$tokenid&operate=$operate' \
       --header 'Accept: application/json' \
       --header 'Content-Type: application/json' \
       --header 'X-API-Key: test'
  ```


### 原数据查看
#### 使用场景
- 用户可以根据持有的NFT查看对应的原数据。

#### 功能描述
用户通过拥有查看权限的NFT调用原数据查看API接口，鉴权通过后，可以查看对应的原数据信息；对于托管存储方式的数据因为是加密的，所以需要先进行[授权访问明文数据](#授权访问明文数据)，否则不能查看到明文数据。

#### 如何使用
- 接口名称：getRawData

- 参数说明

  | 名称             | 类型    | 说明                                                         | 是否必填 |
  | ---------------- | ------- | ------------------------------------------------------------ | -------- |
  | contract_address | address | NFT合约地址                                                  | Y        |
  | chainId          | uint32  | 链id，默认为1，表示ethereum主网                              | N        |
  | tokenid          | string  | NFT的id                                                      | Y        |
  | publicKey        | string  | 用户公钥，原数据使用托管方式存储时需要传此参数；如已经授权，则不可以不传此参数 | N        |

- 响应

  ```json
  {
  	"status": 200,
  	"result": {
  		"token_address": "0x8df91a59b8610990004987ac6ad8b6e70779ee97",
  		"token_id": "1",
  		"owner_of": "0x806164c929ad3a6f4bd70c2370b3ef36c64deaa8",
  		"contract_type": "ERC721",
  		"name": "datum",
  		"symbol": "FZAI1",
          "file_hash": "0x.....................",
          "storage_method": "hosting/Unmanaged",
          "permission_type": "ownership/use", 
  		"metadata": "{
          	"name": "datum", 
          	"description": "this is datum metadata", 
          	"file_type": "csv",
          	"data_size": 100, 
              "columns": 2, 
              "rows": 10, 
              "cols_desc": [
                  {"col_name": "col1", "col_desc": "this is col1 desc"},
                  {"col_name": "col2", "col_desc": "this is col2 desc"}
  			]
  		}",
  		"content": "this is data content."
  	},
  	"msg": "get data success."
  }
  ```

- 示例

  ```shell
  curl --request POST \
       --url 'https://datum.io/api/v2/$contract_address/getRawData?	    chainId=$chainId&tokenid=$tokenid&publicKey=$publicKey' \
       --header 'Accept: application/json' \
       --header 'Content-Type: application/json' \
       --header 'X-API-Key: test'
  ```

### 原数据下载
#### 使用场景
- 用户可以根据持有的NFT下载对应的原数据。

#### 功能描述
用户通过拥有下载权限的NFT调用数据下载API接口，鉴权通过后，可以下载对应的原数据；对于托管存储方式的数据因为是加密的，所以下载前需要先进行[授权访问明文数据](#授权访问明文数据)，否则不能下载明文数据。

#### 如何使用
- 接口名称：downloadData

- 参数说明

  | 名称             | 类型    | 说明                                                         | 是否必填 |
  | ---------------- | ------- | ------------------------------------------------------------ | -------- |
  | contract_address | address | NFT合约地址                                                  | Y        |
  | chainId          | uint32  | 链id，默认为1，表示ethereum主网                              | N        |
  | tokenid          | string  | NFT的id                                                      | Y        |
  | publicKey        | string  | 用户公钥，原数据使用托管方式存储时需要传此参数；如已经授权，则不可以不传此参数 | N        |

- 响应

  ```json
  {
  	"status": 200,
  	"result": {
  		"token_address": "0x8df91a59b8610990004987ac6ad8b6e70779ee97",
  		"token_id": "1",
  		"owner_of": "0x806164c929ad3a6f4bd70c2370b3ef36c64deaa8",
  		"contract_type": "ERC721",
  		"name": "datum",
  		"symbol": "FZAI1",
          "file_type": "csv",
          "file_hash": "0x.....................",
          "storage_method": "hosting/Unmanaged",
          "permission_type": "ownership/use",        
  		"metadata": "{
          	"name": "datum", 
          	"description": "this is datum metadata", 
          	"data_size": 100, 
              "columns": 2, 
              "rows": 10, 
              "cols_desc": [
                  {"col_name": "col1", "col_desc": "this is col1 desc"},
                  {"col_name": "col2", "col_desc": "this is col2 desc"}
  			]
  		}",
  		"file_path": "/path/file.csv"
  	},
  	"msg": "download data file success."
  }
  ```

- 示例

  ```shell
  curl --request POST \
       --url 'https://datum.io/api/v2/$contract_address/downloadData?	    chainId=$chainId&tokenid=$tokenid&publicKey=$publicKey' \
       --header 'Accept: application/json' \
       --header 'Content-Type: application/json' \
       --header 'X-API-Key: test'
  ```



### 授权访问
#### 使用场景
- 数据使用托管方式存储在datum官网或其他第三方时，数据使用方调用此API申请授权访问明文数据。

#### 功能描述
存储在datum官网或其他第三方的数据是加密的，数据使用方通过持有的NFT可以查看或下载托管在调用datum官网或其他第三方的密文数据，而这并没有意义，因此提供了此API，数据使用方通过持有的NFT和自己的公钥调用此API接口，鉴权通过并授权成功后，数据使用方即可拥有查看或下载明文数据的权限，并获得代理重加密过程中的解密密钥，数据使用方通过此密钥即可解密密文数据。


#### 如何使用
- 接口名称：authAccessToRawData

- 参数说明

  | 名称             | 类型    | 说明                                                         | 是否必填 |
  | ---------------- | ------- | ------------------------------------------------------------ | -------- |
  | contract_address | address | NFT合约地址                                                  | Y        |
  | chainId          | uint32  | 链id，默认为1，表示ethereum主网                              | N        |
  | tokenid          | string  | NFT的id                                                      | Y        |
  | publicKey        | string  | 用户公钥，原数据使用托管方式存储时需要传此参数；如已经授权，则不可以不传此参数 | N        |

- 响应

  ```json
  {
  	"status": 200,
  	"result": {
  		"token_address": "0x8df91a59b8610990004987ac6ad8b6e70779ee97",
  		"token_id": "1",
  		"owner_of": "0x806164c929ad3a6f4bd70c2370b3ef36c64deaa8",
  		"contract_type": "ERC721",
  		"name": "datum",
  		"symbol": "FZAI1",
          "storage_method": "hosting/Unmanaged",
  	},
  	"msg": "Authorization to access plaintext data succeeded."
  }
  ```

- 示例

  ```shell
  curl --request POST \
       --url 'https://datum.io/api/v2/$contract_address/downloadData?	    chainId=$chainId&tokenid=$tokenid&publicKey=$publicKey' \
       --header 'Accept: application/json' \
       --header 'Content-Type: application/json' \
       --header 'X-API-Key: test'
  ```




### 访问明文数据权限验证
#### 使用场景
- 用户需要访问的数据是使用托管方式存储在datum官网或其他第三方时，可以调用此API验证是否有明文访问权限；

#### 功能描述
数据使用托管方式存储在datum官网或其他第三方时，用户通过拥有的NFT调用明文权限验证API接口，验证自己是否有明文访问数据权限，如果没有需要进行[授权访问明文数据](#授权访问明文数据)操作；

#### 如何使用
- 接口名称：verifyAccessRawData

- 参数说明

  | 名称             | 类型    | 说明                                                         | 是否必填 |
  | ---------------- | ------- | ------------------------------------------------------------ | -------- |
  | contract_address | address | NFT合约地址                                                  | Y        |
  | chainId          | uint32  | 链id，默认为1，表示ethereum主网                              | N        |
  | tokenid          | string  | NFT的id                                                      | Y        |
  | publicKey        | string  | 用户公钥，原数据使用托管方式存储时需要传此参数；如已经授权，则不可以不传此参数 | N        |

- 响应

  ```json
  {
  	"status": 200,
  	"result": {
  		"token_address": "0x8df91a59b8610990004987ac6ad8b6e70779ee97",
  		"token_id": "1",
  		"owner_of": "0x806164c929ad3a6f4bd70c2370b3ef36c64deaa8",
  		"contract_type": "ERC721",
  		"name": "datum",
  		"symbol": "FZAI1",
          "storage_method": "hosting/Unmanaged",
          "publicKey": "0x......................."
  	},
  	"msg": "Verifying access to plaintext data is successful."
  }
  ```

- 示例

  ```shell
  curl --request POST \
       --url 'https://datum.io/api/v2/$contract_address/verifyAccessRawData?	    chainId=$chainId&tokenid=$tokenid&publicKey=$publicKey' \
       --header 'Accept: application/json' \
       --header 'Content-Type: application/json' \
       --header 'X-API-Key: test'
  ``` 

### 数据一致性验证
为了保证用户下载的数据和数据提供方提供的数据是一致的，用户在下载完数据之后会进行一致性的验证；同时用户也可以在使用数据文件调用API验证一致性。

#### 下载数据一致性验证
#### 使用场景
- 数据下载完成之后，用户可以调用此API验证数据的一致性（内部调用）。
- 使用数据文件之前，调用此API验证数据文件的一致性（外部调用）。

#### 功能描述
对数据文件进行验证，确保数据文件和数据提供方提供的数据保持一致；

#### 如何使用
- 接口名称：verifyDataIntegrity

- 参数说明

  | 名称             | 类型    | 说明                            | 是否必填 |
  | ---------------- | ------- | ------------------------------- | -------- |
  | contract_address | address | NFT合约地址                     | Y        |
  | chainId          | uint32  | 链id，默认为1，表示ethereum主网 | N        |
  | tokenid          | string  | NFT的id                         | Y        |
  | path             | string  | 数据文件路径                    | N        |

- 响应

  ```json
  {
  	"status": 200,
  	"result": {
  		"token_address": "0x8df91a59b8610990004987ac6ad8b6e70779ee97",
  		"token_id": "1",
  		"owner_of": "0x806164c929ad3a6f4bd70c2370b3ef36c64deaa8",
  		"contract_type": "ERC721",
  		"name": "datum",
  		"symbol": "FZAI1",
          "file_hash": "0x.....................",
          "storage_method": "hosting/Unmanaged",
          "publicKey": "0x......................."
  	},
  	"msg": "Verify data consistency is successful."
  }
  ```

- 示例

  ```shell
  curl --request POST \
       --url 'https://datum.io/api/v2/$contract_address/verifyDataIntegrity?	    chainId=$chainId&tokenid=$tokenid&path=$path' \
       --header 'Accept: application/json' \
       --header 'Content-Type: application/json' \
       --header 'X-API-Key: test'
  ```
  
  ###代理重加密
  
  
