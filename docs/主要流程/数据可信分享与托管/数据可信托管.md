---
sidebar_position: 3
---

由于数据拥有者对托管方并不完全信任，不能将解密密文的密钥发送给托管方，由托管方来解密并分享出去。数据拥有者自己下载密文解密后，再用数据接收方的公钥加密并分享，无疑给数据拥有者带来很大的麻烦，同时也失去了数据共享的意义。代理重加密可以在不泄漏数据拥有者解密密钥的情况下，实现密文数据共享；datum官网的托管方式存储数据即使用的是**代理重加密算法**。数据使用方通过调用datum官网或其他第三方上由datum提供的api或sdk服务，即可查看或下载明文数据；其中涉及的API如下：

- 授权访问
- 访问权限验证
- 访问明文权限验证

### 授权访问

#### 功能描述

存储在datum官网或其他第三方的数据是加密的，数据使用方通过持有的NFT可以查看或下载托管在调用datum官网或其他第三方的密文数据，而这并没有意义，因此提供了此API，数据使用方通过持有的NFT和自己的公钥调用此API接口，鉴权通过并授权成功后，数据使用方即可拥有查看或下载明文数据的权限，并获得代理重加密过程中的解密密钥，数据使用方通过此密钥即可解密密文数据。

#### 使用场景

- 数据使用托管方式存储在datum官网或其他第三方时，数据使用方调用此API申请授权访问明文数据。

#### 接口说明（API）

- 接口名称：authAccessToRawData

- 参数说明

  | 名称             | 类型    | 说明                                                         | 是否必填 |
  | ---------------- | ------- | ------------------------------------------------------------ | -------- |
  | contract_address | address | NFT合约地址                                                  | Y        |
  | chainId          | uint32  | 链id，默认为1，表示ethereum主网                              | N        |
  | tokenid          | string  | NFT的id                                                      | Y        |
  | publicKey        | string  | 用户公钥，原数据使用托管方式存储时需要传此参数；如已经授权，则不可以不传此参数 | N        |

- 响应

  ```json
  {
  	"status": 200,
  	"result": {
  		"token_address": "0x8df91a59b8610990004987ac6ad8b6e70779ee97",
  		"token_id": "1",
  		"owner_of": "0x806164c929ad3a6f4bd70c2370b3ef36c64deaa8",
  		"contract_type": "ERC721",
  		"name": "datum",
  		"symbol": "FZAI1",
          "storage_method": "hosting/Unmanaged",
  	},
  	"msg": "Authorization to access plaintext data succeeded."
  }
  ```

- 示例

  ```shell
  curl --request POST \
       --url 'https://datum.io/api/v2/$contract_address/downloadData?	    chainId=$chainId&tokenid=$tokenid&publicKey=$publicKey' \
       --header 'Accept: application/json' \
       --header 'Content-Type: application/json' \
       --header 'X-API-Key: test'
  ```

### 访问权限验证

#### 功能描述

验证用户是否有数据查看或者下载等访问权限；

#### 使用场景

- 数据使用方在访问数据之前，调用此API接口可以验证是否有数据访问权限；

#### 接口说明（API）

- 接口名称：verifyAccess

- 参数说明

  | 名称             | 类型    | 说明                            | 是否必填 |
  | ---------------- | ------- | ------------------------------- | -------- |
  | contract_address | address | NFT合约地址                     | Y        |
  | chainId          | uint32  | 链id，默认为1，表示ethereum主网 | N        |
  | tokenid          | string  | NFT的id                         | Y        |
  | operate          | elem    | 1: 查看，2:下载                 | Y        |

- 响应

  ```json
  {
  	"status": 200,
  	"result": {
  		"token_address": "0x8df91a59b8610990004987ac6ad8b6e70779ee97",
  		"token_id": "1",
  		"owner_of": "0x806164c929ad3a6f4bd70c2370b3ef36c64deaa8",
  		"contract_type": "ERC721",
  		"name": "datum",
  		"symbol": "FZAI1",
          "operate": "view/download"
  	},
  	"msg": "Validation of access rights succeeded."
  }
  ```

- 示例

  ```shell
  curl --request POST \
       --url 'https://datum.io/api/v2/$contract_address/verifyAccess?	    chainId=$chainId&tokenid=$tokenid&operate=$operate' \
       --header 'Accept: application/json' \
       --header 'Content-Type: application/json' \
       --header 'X-API-Key: test'
  ```



### 访问明文数据权限验证

#### 功能描述

数据使用托管方式存储在datum官网或其他第三方时，用户通过拥有的NFT调用明文权限验证API接口，验证自己是否有明文访问数据权限，如果没有需要进行[授权访问明文数据](#授权访问明文数据)操作；

#### 使用场景

- 用户需要访问的数据是使用托管方式存储在datum官网或其他第三方时，可以调用此API验证是否有明文访问权限；

#### 接口说明（API）

- 接口名称：verifyAccessRawData

- 参数说明

  | 名称             | 类型    | 说明                                                         | 是否必填 |
  | ---------------- | ------- | ------------------------------------------------------------ | -------- |
  | contract_address | address | NFT合约地址                                                  | Y        |
  | chainId          | uint32  | 链id，默认为1，表示ethereum主网                              | N        |
  | tokenid          | string  | NFT的id                                                      | Y        |
  | publicKey        | string  | 用户公钥，原数据使用托管方式存储时需要传此参数；如已经授权，则不可以不传此参数 | N        |

- 响应

  ```json
  {
  	"status": 200,
  	"result": {
  		"token_address": "0x8df91a59b8610990004987ac6ad8b6e70779ee97",
  		"token_id": "1",
  		"owner_of": "0x806164c929ad3a6f4bd70c2370b3ef36c64deaa8",
  		"contract_type": "ERC721",
  		"name": "datum",
  		"symbol": "FZAI1",
          "storage_method": "hosting/Unmanaged",
          "publicKey": "0x......................."
  	},
  	"msg": "Verifying access to plaintext data is successful."
  }
  ```

- 示例

  ```shell
  curl --request POST \
       --url 'https://datum.io/api/v2/$contract_address/verifyAccessRawData?	    chainId=$chainId&tokenid=$tokenid&publicKey=$publicKey' \
       --header 'Accept: application/json' \
       --header 'Content-Type: application/json' \
       --header 'X-API-Key: test'
  ``` 