
# 数据可信分享与托管
数据可信分享与托管模块提供了一系列API服务，为许多dapp和web3服务提供支持。

### 为什么使用数据可信分享与托管?
数据可信分享与托管服务可以帮助用户更方便，安全，快速的加入datum网络，因为：
- 使用此模块的api可以方便用户对数据进行鉴权访问；
- 使用此模块的api可以实现用户对数据进行完整性验证；
- 使用此模块的api可以实现对托管数据的安全分享；

### 数据可信分享与托管提供什么？
- NFT属性设置 - 设置NFT的权限等属性
- 所有权转移 - 将原数据对应的NFT所有权转移给指定用户
- 元数据查看 - 查看NFT对应的元数据
- 原数据查看 - 查看NFT对应的原数据
- 原数据下载 - 下载NFT对应的原数据
- 授权访问明文数据 - 授权用户访问托管存储的明文数据
- 访问权限验证 - 访问数据时验证持有NFT的权限
- 访问明文数据权限验证 -  访问托管数据时验证是否有访问明文数据的权限
- 数据完整性验证 - 下载原数据后，进行完整性验证


### 数据可信分享与托管支持哪些链？
- PlatON
- Ethereum
- IPFS
- ....

## 数据可信分享
数据可信分享包括数据查看和下载功能；其中根据数据提供方设置的NFT的权限属性不同，拥有不同的查看权限，分为：元数据查看和原数据查看；主要api和sdk有：

### NFT属性设置
#### 使用场景

- 当数据提供方发行的某个NFT且未转移到其他用户时，如果需要对此NFT的属性进行修改或扩展，如修改访问权限，修改原文件存储路径等，可调用此API进行设置；

#### 功能描述
数据提供方通过调用NFT属性设置API接口，可以设置NFT的属性，如：
- NFT权限属性
  - 所有权权限属性（明文计算）
    - 原数据查看权限属性
    - 原数据下载权限属性
  - 使用权权限属性（密文计算）
    - 次数
    - 有效期
- 原数据文件存储路径属性
- .....

#### 如何使用
- 接口名称：setNFTProperty

- 参数说明

  | 名称             | 类型    | 说明                            | 是否必填 |
  | ---------------- | ------- | ------------------------------- | -------- |
  | contract_address | address | NFT合约地址                     | Y        |
  | chainId          | uint32  | 链id，默认为1，表示ethereum主网 | N        |
  | tokenid          | string  | NFT的id                         | Y        |
  | property         | string  | NFT属性描述，json格式           | Y        |

- 响应

  ```json
  {
      "status": 200,
      "result": {
          "transaction_hash": "0xxxxxxxxxxxxxxxxxxxx"
      },
      "msg": "set NFT Property success"
  }
  ```

- 示例

  ```shell
  curl --request POST \
       --url 'https://datum.io/api/v2/$contract_address/setNFTProperty?	    chainId=$chainId&tokenid=$tokenid&property=$property' \
       --header 'Accept: application/json' \
       --header 'Content-Type: application/json' \
       --header 'X-API-Key: test'
  ```



### 所有权转移
#### 使用场景
- 数据使用方和数据提供方线下达成协商时，数据提供方可通过调用此API将数据对应的NFT转发给数据使用方，让其获得所有权。

#### 功能描述
用户通过调用所有权转移API接口，可以给指定的其他用户赋予数据的所有权；拥有数据所有权的用户可以对数据进行查看或下载操作。

#### 如何使用
- 接口名称：passOwnership

- 参数说明

  | 名称             | 类型    | 说明                            | 是否必填 |
  | ---------------- | ------- | ------------------------------- | -------- |
  | contract_address | address | NFT合约地址                     | Y        |
  | chainId          | uint32  | 链id，默认为1，表示ethereum主网 | N        |
  | tokenid          | string  | NFT的id                         | Y        |
  | to_address       | address | 数据使用方地址                  | Y        |

- 响应

  ```json
  {
      "status": 200,
      "result": {
          transaction_hash: "0xxxxxxxxxxxxxxxxxxxx"
      },
      "msg": "pass NFT Ownership success."
  }
  ```

- 示例

  ```shell
  curl --request POST \
       --url 'https://datum.io/api/v2/$contract_address/passOwnership?	    chainId=$chainId&tokenid=$tokenid&to_address=$to_address' \
       --header 'Accept: application/json' \
       --header 'Content-Type: application/json' \
       --header 'X-API-Key: test'
  ```

### 元数据查看
#### 使用场景
- 数据使用方在获得原数据对应的NFT之前，可以调用此API查询对应元数据，然后判断出NFT对应的原数据是否是用户需要的；

#### 功能描述
用户通过调用元数据查看API接口，在链上查询对应的元数据信息；此调用过程不需要鉴权。

#### 如何使用
- 接口名称：getMetaData
- 参数说明

  | 名称             | 类型    | 说明                            | 是否必填 |
  | ---------------- | ------- | ------------------------------- | -------- |
  | contract_address | address | NFT合约地址                     | Y        |
  | chainId          | uint32  | 链id，默认为1，表示ethereum主网 | N        |
  | tokenid          | string  | NFT的id                         | Y        |

- 响应

  ```json
  {
  	"status": 200,
  	"result": {
  		"token_address": "0x8df91a59b8610990004987ac6ad8b6e70779ee97",
  		"token_id": "1",
  		"owner_of": "0x806164c929ad3a6f4bd70c2370b3ef36c64deaa8",
  		"contract_type": "ERC721",
  		"name": "datum",
  		"symbol": "FZAI1",
          "file_hash": "0x.....................",
          "storage_method": "hosting/Unmanaged",
          "permission_type": "ownership/use", 
  		"metadata": "{
          	"name": "datum", 
          	"description": "this is datum metadata", 
          	"data_size": 100, 
              "columns": 2, 
              "rows": 10, 
              "cols_desc": [
                  {"col_name": "col1", "col_desc": "this is col1 desc"},
                  {"col_name": "col2", "col_desc": "this is col2 desc"}
  			]
  		}"
  	},
  	"msg": "get MetaData success."
  }
  ```

- 示例

  ```shell
  curl --request POST \
       --url 'https://datum.io/api/v2/$contract_address/getMetaData?	     	chainId=$chainId&tokenid=$tokenid' \
       --header 'Accept: application/json' \
       --header 'Content-Type: application/json' \
       --header 'X-API-Key: test'
  ```

### 原数据查看
#### 使用场景
- 用户可以根据持有的NFT查看对应的原数据。

#### 功能描述
用户通过拥有查看权限的NFT调用原数据查看API接口，鉴权通过后，可以查看对应的原数据信息；对于托管存储方式的数据因为是加密的，所以需要先进行[授权访问明文数据](#授权访问明文数据)，否则不能查看到明文数据。

#### 如何使用
- 接口名称：getRawData

- 参数说明

  | 名称             | 类型    | 说明                                                         | 是否必填 |
  | ---------------- | ------- | ------------------------------------------------------------ | -------- |
  | contract_address | address | NFT合约地址                                                  | Y        |
  | chainId          | uint32  | 链id，默认为1，表示ethereum主网                              | N        |
  | tokenid          | string  | NFT的id                                                      | Y        |
  | publicKey        | string  | 用户公钥，原数据使用托管方式存储时需要传此参数；如已经授权，则不可以不传此参数 | N        |

- 响应

  ```json
  {
  	"status": 200,
  	"result": {
  		"token_address": "0x8df91a59b8610990004987ac6ad8b6e70779ee97",
  		"token_id": "1",
  		"owner_of": "0x806164c929ad3a6f4bd70c2370b3ef36c64deaa8",
  		"contract_type": "ERC721",
  		"name": "datum",
  		"symbol": "FZAI1",
          "file_hash": "0x.....................",
          "storage_method": "hosting/Unmanaged",
          "permission_type": "ownership/use", 
  		"metadata": "{
          	"name": "datum", 
          	"description": "this is datum metadata", 
          	"file_type": "csv",
          	"data_size": 100, 
              "columns": 2, 
              "rows": 10, 
              "cols_desc": [
                  {"col_name": "col1", "col_desc": "this is col1 desc"},
                  {"col_name": "col2", "col_desc": "this is col2 desc"}
  			]
  		}",
  		"content": "this is data content."
  	},
  	"msg": "get data success."
  }
  ```

- 示例

  ```shell
  curl --request POST \
       --url 'https://datum.io/api/v2/$contract_address/getRawData?	    chainId=$chainId&tokenid=$tokenid&publicKey=$publicKey' \
       --header 'Accept: application/json' \
       --header 'Content-Type: application/json' \
       --header 'X-API-Key: test'
  ```

### 原数据下载
#### 使用场景
- 用户可以根据持有的NFT下载对应的原数据。

#### 功能描述
用户通过拥有下载权限的NFT调用数据下载API接口，鉴权通过后，可以下载对应的原数据；对于托管存储方式的数据因为是加密的，所以下载前需要先进行[授权访问明文数据](#授权访问明文数据)，否则不能下载明文数据。

#### 如何使用
- 接口名称：downloadData

- 参数说明

  | 名称             | 类型    | 说明                                                         | 是否必填 |
  | ---------------- | ------- | ------------------------------------------------------------ | -------- |
  | contract_address | address | NFT合约地址                                                  | Y        |
  | chainId          | uint32  | 链id，默认为1，表示ethereum主网                              | N        |
  | tokenid          | string  | NFT的id                                                      | Y        |
  | publicKey        | string  | 用户公钥，原数据使用托管方式存储时需要传此参数；如已经授权，则不可以不传此参数 | N        |

- 响应

  ```json
  {
  	"status": 200,
  	"result": {
  		"token_address": "0x8df91a59b8610990004987ac6ad8b6e70779ee97",
  		"token_id": "1",
  		"owner_of": "0x806164c929ad3a6f4bd70c2370b3ef36c64deaa8",
  		"contract_type": "ERC721",
  		"name": "datum",
  		"symbol": "FZAI1",
          "file_type": "csv",
          "file_hash": "0x.....................",
          "storage_method": "hosting/Unmanaged",
          "permission_type": "ownership/use",        
  		"metadata": "{
          	"name": "datum", 
          	"description": "this is datum metadata", 
          	"data_size": 100, 
              "columns": 2, 
              "rows": 10, 
              "cols_desc": [
                  {"col_name": "col1", "col_desc": "this is col1 desc"},
                  {"col_name": "col2", "col_desc": "this is col2 desc"}
  			]
  		}",
  		"file_path": "/path/file.csv"
  	},
  	"msg": "download data file success."
  }
  ```

- 示例

  ```shell
  curl --request POST \
       --url 'https://datum.io/api/v2/$contract_address/downloadData?	    chainId=$chainId&tokenid=$tokenid&publicKey=$publicKey' \
       --header 'Accept: application/json' \
       --header 'Content-Type: application/json' \
       --header 'X-API-Key: test'
  ```

## 数据可信托管

由于数据拥有者对托管方并不完全信任，不能将解密密文的密钥发送给托管方，由托管方来解密并分享出去。数据拥有者自己下载密文解密后，再用数据接收方的公钥加密并分享，无疑给数据拥有者带来很大的麻烦，同时也失去了数据共享的意义。代理重加密可以在不泄漏数据拥有者解密密钥的情况下，实现密文数据共享；datum官网的托管方式存储数据即使用的是**代理重加密算法**。数据使用方通过调用datum官网或其他第三方上由datum提供的api或sdk服务，即可查看或下载明文数据；其中涉及的API如下：

- 授权访问
- 访问权限验证
- 访问明文权限验证

### 授权访问
#### 使用场景
- 数据使用托管方式存储在datum官网或其他第三方时，数据使用方调用此API申请授权访问明文数据。

#### 功能描述
存储在datum官网或其他第三方的数据是加密的，数据使用方通过持有的NFT可以查看或下载托管在调用datum官网或其他第三方的密文数据，而这并没有意义，因此提供了此API，数据使用方通过持有的NFT和自己的公钥调用此API接口，鉴权通过并授权成功后，数据使用方即可拥有查看或下载明文数据的权限，并获得代理重加密过程中的解密密钥，数据使用方通过此密钥即可解密密文数据。


#### 如何使用
- 接口名称：authAccessToRawData

- 参数说明

  | 名称             | 类型    | 说明                                                         | 是否必填 |
  | ---------------- | ------- | ------------------------------------------------------------ | -------- |
  | contract_address | address | NFT合约地址                                                  | Y        |
  | chainId          | uint32  | 链id，默认为1，表示ethereum主网                              | N        |
  | tokenid          | string  | NFT的id                                                      | Y        |
  | publicKey        | string  | 用户公钥，原数据使用托管方式存储时需要传此参数；如已经授权，则不可以不传此参数 | N        |

- 响应

  ```json
  {
  	"status": 200,
  	"result": {
  		"token_address": "0x8df91a59b8610990004987ac6ad8b6e70779ee97",
  		"token_id": "1",
  		"owner_of": "0x806164c929ad3a6f4bd70c2370b3ef36c64deaa8",
  		"contract_type": "ERC721",
  		"name": "datum",
  		"symbol": "FZAI1",
          "storage_method": "hosting/Unmanaged",
  	},
  	"msg": "Authorization to access plaintext data succeeded."
  }
  ```

- 示例

  ```shell
  curl --request POST \
       --url 'https://datum.io/api/v2/$contract_address/downloadData?	    chainId=$chainId&tokenid=$tokenid&publicKey=$publicKey' \
       --header 'Accept: application/json' \
       --header 'Content-Type: application/json' \
       --header 'X-API-Key: test'
  ```

### 访问权限验证
#### 使用场景
- 数据使用方在访问数据之前，调用此API接口可以验证是否有数据访问权限；

#### 功能描述
验证用户是否有数据查看或者下载等访问权限；

#### 如何使用
- 接口名称：verifyAccess

- 参数说明

  | 名称             | 类型    | 说明                            | 是否必填 |
  | ---------------- | ------- | ------------------------------- | -------- |
  | contract_address | address | NFT合约地址                     | Y        |
  | chainId          | uint32  | 链id，默认为1，表示ethereum主网 | N        |
  | tokenid          | string  | NFT的id                         | Y        |
  | operate          | elem    | 1: 查看，2:下载                 | Y        |

- 响应

  ```json
  {
  	"status": 200,
  	"result": {
  		"token_address": "0x8df91a59b8610990004987ac6ad8b6e70779ee97",
  		"token_id": "1",
  		"owner_of": "0x806164c929ad3a6f4bd70c2370b3ef36c64deaa8",
  		"contract_type": "ERC721",
  		"name": "datum",
  		"symbol": "FZAI1",
          "operate": "view/download"
  	},
  	"msg": "Validation of access rights succeeded."
  }
  ```

- 示例

  ```shell
  curl --request POST \
       --url 'https://datum.io/api/v2/$contract_address/verifyAccess?	    chainId=$chainId&tokenid=$tokenid&operate=$operate' \
       --header 'Accept: application/json' \
       --header 'Content-Type: application/json' \
       --header 'X-API-Key: test'
  ```



### 访问明文数据权限验证
#### 使用场景
- 用户需要访问的数据是使用托管方式存储在datum官网或其他第三方时，可以调用此API验证是否有明文访问权限；

#### 功能描述
数据使用托管方式存储在datum官网或其他第三方时，用户通过拥有的NFT调用明文权限验证API接口，验证自己是否有明文访问数据权限，如果没有需要进行[授权访问明文数据](#授权访问明文数据)操作；

#### 如何使用
- 接口名称：verifyAccessRawData

- 参数说明

  | 名称             | 类型    | 说明                                                         | 是否必填 |
  | ---------------- | ------- | ------------------------------------------------------------ | -------- |
  | contract_address | address | NFT合约地址                                                  | Y        |
  | chainId          | uint32  | 链id，默认为1，表示ethereum主网                              | N        |
  | tokenid          | string  | NFT的id                                                      | Y        |
  | publicKey        | string  | 用户公钥，原数据使用托管方式存储时需要传此参数；如已经授权，则不可以不传此参数 | N        |

- 响应

  ```json
  {
  	"status": 200,
  	"result": {
  		"token_address": "0x8df91a59b8610990004987ac6ad8b6e70779ee97",
  		"token_id": "1",
  		"owner_of": "0x806164c929ad3a6f4bd70c2370b3ef36c64deaa8",
  		"contract_type": "ERC721",
  		"name": "datum",
  		"symbol": "FZAI1",
          "storage_method": "hosting/Unmanaged",
          "publicKey": "0x......................."
  	},
  	"msg": "Verifying access to plaintext data is successful."
  }
  ```

- 示例

  ```shell
  curl --request POST \
       --url 'https://datum.io/api/v2/$contract_address/verifyAccessRawData?	    chainId=$chainId&tokenid=$tokenid&publicKey=$publicKey' \
       --header 'Accept: application/json' \
       --header 'Content-Type: application/json' \
       --header 'X-API-Key: test'
  ``` 

## 数据一致性验证
为了保证用户下载的数据和数据提供方提供的数据是一致的，用户在下载完数据之后会进行一致性的验证；同时用户也可以在使用数据文件调用API验证一致性。

### 下载数据一致性验证
#### 使用场景
- 数据下载完成之后，用户可以调用此API验证数据的一致性（内部调用）。
- 使用数据文件之前，调用此API验证数据文件的一致性（外部调用）。

#### 功能描述
对数据文件进行验证，确保数据文件和数据提供方提供的数据保持一致；

#### 如何使用
- 接口名称：verifyDataIntegrity

- 参数说明

  | 名称             | 类型    | 说明                            | 是否必填 |
  | ---------------- | ------- | ------------------------------- | -------- |
  | contract_address | address | NFT合约地址                     | Y        |
  | chainId          | uint32  | 链id，默认为1，表示ethereum主网 | N        |
  | tokenid          | string  | NFT的id                         | Y        |
  | path             | string  | 数据文件路径                    | N        |

- 响应

  ```json
  {
  	"status": 200,
  	"result": {
  		"token_address": "0x8df91a59b8610990004987ac6ad8b6e70779ee97",
  		"token_id": "1",
  		"owner_of": "0x806164c929ad3a6f4bd70c2370b3ef36c64deaa8",
  		"contract_type": "ERC721",
  		"name": "datum",
  		"symbol": "FZAI1",
          "file_hash": "0x.....................",
          "storage_method": "hosting/Unmanaged",
          "publicKey": "0x......................."
  	},
  	"msg": "Verify data consistency is successful."
  }
  ```

- 示例

  ```shell
  curl --request POST \
       --url 'https://datum.io/api/v2/$contract_address/verifyDataIntegrity?	    chainId=$chainId&tokenid=$tokenid&path=$path' \
       --header 'Accept: application/json' \
       --header 'Content-Type: application/json' \
       --header 'X-API-Key: test'
  ```
