---
sidebar_position: 3
---

# 多方数据协作

多方数据协作的场景，不仅支持两方数据协作，也支持三方及三方以上的数据协作。

### 联合统计分析

**主要功能**

在保证所有数据提供方不泄露各自敏感数据的前提下，对数据提供方的数据完成联合统计分析。提供两种方式：常用统计公式（如求和、求平均、求方差、合格投资人发现等），自定义统计公式。

**接口说明（API）**

+ 接口名称：runModelTrainTask

+ 请求【POST】

  ```
  {
  	"data_providers": [
  		{
  			"name": "orgA",
  			"data_path": "/path/to/data",
  			"data_type": "csv",
  			"key_column": "id_col",
              "data_alias": "df1"
  		},
  		{
  			"name": "orgB",
  			"data_path": "/path/to/data",
  			"data_type": "csv",
  			"key_column": "id_col",
              "data_alias": "df2"
  		}
  	],
  	"result_receivers": ["orgA", "orgB"],
  	"method": "custom",
      "expression": "df1.unit_price * df2.units",
      "result_alias": "total_value"
  }
  ```

  参数说明

  | 参数             | 类型   | 说明                                                         | 是否必须 |
  | ---------------- | ------ | ------------------------------------------------------------ | -------- |
  | data_providers   | list   | 数据提供方的信息                                             | Y        |
  | name             | string | 组织名称                                                     | Y        |
  | data_path        | string | 数据所在路径                                                 | Y        |
  | data_type        | string | 数据格式                                                     | Y        |
  | data_alias       | string | 为数据取的别名                                               | N        |
  | key_column       | string | 所需操作的列                                                 | Y        |
  | result_receivers | list   | 接收方列表                                                   | Y        |
  | method           | string | 联合统计方法，目前支持:<br />sum, avg, var, is_investor_accredited, <br />自定义公式custom 等 | Y        |
  | expression       | string | 计算表达式，当method字段取值custom时使用                     | N        |
  | result_alias     | string | 为结果取的别名                                               | N        |

+ 响应

  ```
  {
      "status": 200,
  	"result": {
  		"path": "/path/to/result/file",
  		"type": "csv",
  		"extra": ""
  	},
  	"msg": "success"
  }
  ```

  参数说明

  | 参数   | 类型   | 说明                                                       |
  | ------ | ------ | ---------------------------------------------------------- |
  | status | int    | 响应状态，<br />200-成功，400-无效请求，500-服务器内部错误 |
  | result | json   | 结果信息                                                   |
  | path   | string | 结果所在路径                                               |
  | type   | string | 结果的类型                                                 |
  | extra  | string | 关于结果的额外信息                                         |
  | msg    | string | 成功信息或错误的描述                                       |





### 联合模型训练

**主要功能**

在保证所有数据提供方不泄露各自敏感数据的前提下，完成联合模型训练。支持算法：逻辑回归、线性回归、DNN、XGBoost等。

**接口说明（API）**

+ 接口名称：runModelTrainTask

+ 请求【POST】

  ```
  {
  	"data_providers": [
  		{
  			"name": "orgA",
  			"data_path": "/path/to/data",
  			"data_type": "csv",
  			"label_column": "is_good",
              "key_column": "id", 
              "select_columns": ["col1"],
              "discrete_columns": ["type"]
  		},
  		{
  			"name": "orgB",
  			"data_path": "/path/to/data",
  			"data_type": "csv",
  			"label_column": "is_good",
              "key_column": "id", 
              "select_columns": ["col1"],
              "discrete_cols": ["type"]
  		}
  	],
  	"result_receivers": ["orgA"],
      "hyper_params": {"learning_rate": 0.00001, "loss": "mse"},
      "metrics": ["accuracy", "precision", "recall"],
      "model_config": {""}
  }
  ```

  参数说明

  | 参数             | 类型   | 说明                                  | 是否必须 |
  | ---------------- | ------ | ------------------------------------- | -------- |
  | data_providers   | list   | 所有数据提供方信息                    | Y        |
  | name             | string | 组织名称                              | Y        |
  | data_path        | string | 数据所在路径                          | Y        |
  | data_type        | string | 数据格式                              | Y        |
  | label_column     | string | 作为标签的列                          | Y        |
  | key_column       | string | 索引列，用于对齐                      | N        |
  | select_columns   | list   | 选择用于模型训练的列，默认为所有      | N        |
  | discrete_cols    | list   | 离散特征列，用于某些处理，如embedding | N        |
  | result_receivers | list   | 接收方列表                            | Y        |
  | hyper_params     | string | 超参数，和训练方法相关                | N        |
  | metrics          | list   | 对模型的度量，默认为loss              | N        |
  | model_config     | string | 描述复杂DNN模型的 json 串             | N        |

+ 响应

  ```
  {
      "status": 200,
  	"result": {
          "model_id": "0xd22"
  		"path": "/path/to/model",
  		"type": "bin",
  		"extra": "",
          "metrics": {"accuracy": 0.95}
  	},
  	"msg": "success"
  }
  ```

  参数说明

  | 参数     | 类型   | 说明                                                       |
  | -------- | ------ | ---------------------------------------------------------- |
  | status   | int    | 响应状态，<br />200-成功，400-无效请求，500-服务器内部错误 |
  | result   | json   | 结果信息                                                   |
  | model_id | string | 模型id                                                     |
  | path     | string | 结果所在路径                                               |
  | type     | string | 结果的类型                                                 |
  | extra    | string | 关于结果的额外信息                                         |
  | metrics  | json   | 各种要求的度量指标                                         |
  | msg      | string | 成功信息或错误的描述                                       |



### 联合模型预测

**主要功能**

在保证所有数据提供方不泄露各自敏感数据的前提下，完成联合模型预测。支持算法：逻辑回归、线性回归、DNN、XGBoost等。

**接口说明（API）**

+ 接口名称：runModelPredictTask

+ 请求【POST】

  ```
  {
  	"data_providers": [
  		{
  			"name": "orgA",
  			"data_path": "/path/to/data",
  			"data_type": "csv",
              "key_column": "id", 
  		},
  		{
  			"name": "orgB",
  			"data_path": "/path/to/data",
  			"data_type": "csv",
              "key_column": "id", 
  		}
  	],
  	"result_receivers": ["orgA"],
      "params": {"threshold": 0.8}
  }
  ```

  参数说明

  | 参数             | 类型   | 说明               | 是否必须 |
  | ---------------- | ------ | ------------------ | -------- |
  | data_providers   | list   | 所有数据提供方信息 | Y        |
  | name             | string | 组织名称           | Y        |
  | data_path        | string | 数据所在路径       | Y        |
  | data_type        | string | 数据格式           | Y        |
  | key_column       | string | 索引列，用于对齐   | N        |
  | result_receivers | list   | 接收方列表         | Y        |
  | params           | json   | 参数               | N        |

+ 响应

  ```
  {
      "status": 200,
  	"result": {
  		"path": "/path/to/result/file",
  		"type": "csv",
  		"extra": ""
  	},
  	"msg": "success"
  }
  ```

  参数说明

  | 参数   | 类型   | 说明                                                       |
  | ------ | ------ | ---------------------------------------------------------- |
  | status | int    | 响应状态，<br />200-成功，400-无效请求，500-服务器内部错误 |
  | result | json   | 结果信息                                                   |
  | path   | string | 结果所在路径                                               |
  | type   | string | 结果的类型                                                 |
  | extra  | string | 关于结果的额外信息                                         |
  | msg    | string | 成功信息或错误的描述                                       |

